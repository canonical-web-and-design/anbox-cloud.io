{% extends '_layout.html' %}

{% block title %}Anbox Cloud - Scalable Android in the cloud{% endblock %}

{% block description %}Anbox Cloud is the mobile cloud computing platform delivered by Canonical. Run Android in the cloud, at high scale and on any type of hardware. Canonical partners with cloud providers and computing hardware manufacturers to accelerate your time to market and provide long term commercial support.{% endblock %}

{% block content %}
<script type="module">
  import AnboxStream from '/static/js/anbox-stream-sdk.js';
  // @ params appName: name of the application to stream
  function streamContainer(appName, height = false, width = false) {
    var container = document.getElementById(appName);
    var errorContainer = container.getElementsByClassName("js-error-container")[0];
    var errorMessage = container.getElementsByClassName("js-error")[0];
    var button = container.getElementsByClassName("js-button")[0];
    var player = document.getElementById(appName + "-player");
    var loading = container.getElementsByClassName("js-loading")[0];
    var play = container.getElementsByClassName("js-play")[0];

    play.classList.add("u-hide");
    loading.classList.remove("u-hide");

    let stream = new AnboxStream({
      targetElement: player.id,
      url: '{{ ANBOXCLOUD_API_BASE }}',
      authToken: '{{ session["authentication_token"] }}',
      session: {
        app: "com.vectorunit.cobalt.canonical", // Given
      },
      screen: {
        width: width && width < 1104 ? width : 1104,
        height: height && height < 628 ? height : 628,
        fps: 25
      },
      // Using keyboard controls to test it on non-touch device
      controls: {
        keyboard: true
      },
      callbacks: {
        error: error => {
          button.classList.remove("u-hide");
          player.classList.add('u-hide');
          loading.classList.add("u-hide");
          play.classList.remove("u-hide");
          errorMessage.textContent = error + ". Please try again.";
          errorContainer.classList.remove('u-hide');
        },
        ready: ready => {
          button.classList.add("u-hide");
          player.classList.remove('u-hide');
        }
      }
    });
    stream.connect();
  }

  var streams = Array.from(document.getElementsByClassName('p-stream'));

  streams.forEach((stream, i) => {
    stream.getElementsByClassName("js-button")[0].addEventListener('click', function() {
      streamContainer(stream.id, stream.offsetHeight, stream.offsetWidth);
    })
  });
</script>

<section class="p-strip--suru-topped">
  <div class="row">
    <div class="col-7">
      <h1>Anbox Cloud: Try it yourself</h1>
    </div>
  </div>
</section>
<section class="p-strip--dark is-bordered">
  <div class="row">
    <div class="col-12 u-align--center">
      {% with app="buggy-racing" %}
        {% include "_anbox-embed.html" %}
      {% endwith %}
    </div>
  </div>
</section>
<section class="p-strip is-shallow is-bordered">
  <div class="row">
    <div class="col-8">
      <p>More information about Anbox Cloud can be found on the <a href="/">homepage</a></p>
    </div>
  </div>
</section>
{% endblock %}
